<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DM Logo 25</title>
  <script src="http://acko.net/files/mathbox2/mathbox-bundle.min.js"></script>
  <link rel="stylesheet" href="http://acko.net/files/mathbox2/mathbox.css">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
</head>
<body>
  <script>
    var mathbox = mathBox({
      plugins: ['core', 'controls', 'cursor'],
      controls: {
        klass: THREE.OrbitControls
      },
    });
	if (mathbox.fallback) throw "WebGL error";
    var three = mathbox.three;

    three.camera.position.set(5.5, .5, -2.3);
    three.renderer.setClearColor(new THREE.Color(0xFFFFFF), 1.0);

	function reuleaux(i, j, k) {
		var rad = j / 20.0 * Math.PI / 3.0
		var y_centre = Math.sin(Math.PI/3) /3
		if(k==0) {
			var u = Math.cos(rad)-0.5
			var v = Math.sin(rad)-y_centre
		}
		else if(k==1) {
			var u = 0.5-Math.cos(rad)
			var v = Math.sin(rad)-y_centre
		}
		else if(k==2) {
			var u = Math.sin(rad - Math.PI/6)
			var v = y_centre*2-Math.cos(rad - Math.PI/6)
		}
		var az = i / 100.0 * Math.PI * 2.0 
		var r = Math.sqrt(u*u+v*v)
		var th = Math.atan2(v,u) + az*2/3 //twist it!
		var rr = 1.1
		var x = Math.sin(az+ Math.PI/3) * (1+r*Math.cos(th)*rr)
		var y = Math.cos(az+ Math.PI/3) * (1.1+r*Math.cos(th)*rr)
		var z = r*Math.sin(th)*rr
		return {x: x, y: z, z: y}
	}

	var view = mathbox.cartesian({scale: [0.1, 0.1, 0.1]})
	view.voxel({
		width: 100, height: 20, depth: 3,
		items: 4, channels: 3,
		expr: function (emit, i, j, k, t) {
			var p0 = reuleaux(i,j,k); emit(p0.x, p0.y, p0.z)
			var p1 = reuleaux(i+1,j,k); emit(p1.x, p1.y, p1.z);
			var p2 = reuleaux(i+1,j+1,k); emit(p2.x, p2.y, p2.z);
			var p3 = reuleaux(i,j+1,k); emit(p3.x, p3.y, p3.z);
		}
	})
	for(var i=-2; i<=2; ++i)
	for(var j=-2; j<=2; ++j)
		view.transform({position: [-j*3.5, 0, -i*3.5]})
			.transform({rotation: [(i+1)/Math.PI, 0, (j+2)/5.0]})
			.face({color: (i==-2 && j==-1 )?0x60B0FF : 0xEEEEEE, shaded: false})
			.face({color: (i==-2 && j==-1 )?0x60B0FF : 0xEEEEEE, shaded: true, opacity: 0.5})

  </script>
</body>
</html>
